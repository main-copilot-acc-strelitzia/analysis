var t,e,i,s,n,r,a,h,l,o,u,c,f,m,b,d,g=t=>{throw TypeError(t)},M=(t,e,i)=>e.has(t)||g("Cannot "+i),p=(t,e,i)=>(M(t,e,"read from private field"),i?i.call(t):e.get(t)),y=(t,e,i)=>e.has(t)?g("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),w=(t,e,i,s)=>(M(t,e,"write to private field"),s?s.call(t,i):e.set(t,i),i),U=(t,e,i)=>(M(t,e,"access private method"),i);import{c as k,a as T}from"./B6FSvflP.js";import{n as x}from"./BAEQURWy.js";import"./HcGwWu0z.js";function C(t,e=1,i=0){const s=new Date(t);return A(s,e,i),s.getTime()}function A(t,e=1,i=1){switch(e){case 1:t.setUTCMinutes(t.getUTCMinutes()+1*i);break;case 5:t.setUTCMinutes(t.getUTCMinutes()+5*i);break;case 15:t.setUTCMinutes(t.getUTCMinutes()+15*i);break;case 30:t.setUTCMinutes(t.getUTCMinutes()+30*i);break;case 60:t.setUTCHours(t.getUTCHours()+1*i);break;case 240:t.setUTCHours(t.getUTCHours()+4*i);break;case 1440:t.setUTCDate(t.getUTCDate()+1*i);break;case 10080:t.setUTCDate(t.getUTCDate()+7*i);break;case 43200:t.setUTCMonth(t.getUTCMonth()+1*i)}}const V=Object.freeze(Object.defineProperty({__proto__:null,dateOffset:C,dateShift:A},Symbol.toStringTag,{value:"Module"}));function D(t,e,i){if(t===e)return 0;const s=(t>e?t:e)-(t<e?t:e);return Math.round(s/(60*i*1e3))}function L(t,e,i){if(-1==="YMDhm".indexOf(i))return 0;if(t===e)return 0;const s=t<e?t:e,n=t>e?t:e;switch(i){case"Y":return D(s,n,518400);case"M":return D(s,n,43200);case"D":return D(s,n,1440);case"h":return D(s,n,60);case"m":return D(s,n,1);default:return 0}}function B(t){const e=new Uint32Array(t);return 1e3*e[e.length-12]}class N extends k{constructor(s,n,r,a){super("bars"),y(this,i),y(this,t),y(this,e),this.lastTo=0,this.buffer=a||new ArrayBuffer(0),this.symbol=s,this.period=n,w(this,e,r),this.real=!1,this.pending=!1,this.pendingDirection=0,this.final=!1,this.lastLoadedBarTime=0,U(this,i,l).call(this),w(this,t,new DataView(this.buffer))}static get MAX_COUNT(){return 9e3}impose(t){if(!t.byteLength)return this;const e=this.time(0),s=this.time(this.length-1),n=this.buffer.byteLength,r=function(t){return 1e3*new Uint32Array(t)[0]}(t),a=B(t),h=t.byteLength,o=U(this,i,d).call(this,r),u=U(this,i,d).call(this,a);let c,f=0,m=0;-1===o&&-1===u?(a<e&&(c=n+h,f=0,m=h),r>s&&(c=n+h,m=0,f=n),r<e&&a>s&&(c=h,f=0,m=0)):o>=0&&u>=0?(c=n,m=0,f=48*o):o>=0?(c=48*o+h,m=0,f=48*o):u>=0&&(c=h+n-48*(u+1),f=0,m=h-48*(u+1));const b=new Uint8Array(Math.max(m+n,f+h));return b.set(new Uint8Array(this.buffer),m),b.set(new Uint8Array(t),f),this.buffer=b.buffer.slice(0,c),U(this,i,l).call(this),this.trigger("600",{symbol:this.symbol,period:this.period}),this}time(t){if(t<0)return C(this.time(0),this.period,t);const e=this.length;return t>=e&&(0!==t||0!==e)?C(this.time(e-1),this.period,t-e+1):1e3*U(this,i,c).call(this,48*t+0)}open(t){return U(this,i,o).call(this,48*t+4)}high(t){return U(this,i,o).call(this,48*t+12)}low(t){return U(this,i,o).call(this,48*t+20)}close(t){return U(this,i,o).call(this,48*t+28)}tickVolume(t){return U(this,i,f).call(this,48*t+36)}realVolume(t){return U(this,i,o).call(this,48*t+40)}bar(t){return{time:this.time(t),open:this.open(t),high:this.high(t),low:this.low(t),close:this.close(t),tickVolume:this.tickVolume(t),realVolume:this.realVolume(t)}}index(t,e=!1){if(!this.length)return-1;const s=this.time(this.length-1);if(t>s)return this.length-1+D(s,t,this.period);const n=this.time(0);if(t<n)return-D(n,t,this.period);const r=U(this,i,d).call(this,t,e);return-1!==r?r:-1}max(t,e,i){let s=Number.MIN_VALUE,n=t;for(;n<e;){let t;switch(i){case 1:t=this.tickVolume(n);break;case 2:t=this.realVolume(n);break;default:t=this.high(n)}null!==t&&(s=Math.max(s,t)),n+=1}return s}minmax(t,e){let i=Number.MAX_VALUE,s=Number.MIN_VALUE,n=t;for(;n<e;){const t=this.low(n),e=this.high(n);null!==t&&0!==t&&(i=Math.min(i,t),s=Math.max(s,e)),n+=1}return i!==Number.MAX_VALUE||s!==Number.MIN_VALUE?[i,s]:[0,0]}get length(){return this.buffer&&this.buffer.byteLength/48||0}extends(t,l){if(delete this.lastBarAfter,delete this.lastBarBefore,delete this.lastPrice,delete this.askPrice,l.timeMs){const o=T(l.timeMs,this.period);let u=this.length-1;const c=this.time(u);if(o<c)return;this.askPrice=x(l.askOriginal,t.digits);const f=function(t,e){let i=0;"number"==typeof e.fields&&1&e.fields&&(i=e.bidOriginal);let s=0;"number"==typeof e.fields&&4&e.fields&&(s=e.last);let n=0;if(void 0!==t.chartMode)switch(t.chartMode){case 0:n=i;break;case 1:n=s;break;case 255:n=0===s&&(t.ticksBookDepth??0)<1?i:s;break;default:return 0}else n=0===Number(e.lastLast)&&(t.ticksBookDepth??0)<1?Number(e.bidOriginal):Number(e.lastLast);return x(n,t.digits)}(t,l);if(!f)return;this.lastBarBefore=this.bar(this.length-1);const m=D(o,c,this.period);m<=1&&(1===m&&(this.impose(function(t,e,i=100,s=0){const n=new ArrayBuffer(48*i),r=new Date(T(t,e)),a=new DataView(n);for(let h=i-1;h>=0;h--){let t=48*h;a.setInt32(t,r.getTime()/1e3,!0),a.setFloat64(t+=4,s||1,!0),a.setFloat64(t+=8,s||1,!0),a.setFloat64(t+=8,s||0,!0),a.setFloat64(t+=8,s||0,!0),A(r,e,-1)}return n}(o,this.period,1,f)),u+=1),"number"==typeof l.fields&&8&l.fields&&U(this,i,h).call(this,u,this.realVolume(u)+p(this,e).call(this,l.volLast,8)),U(this,i,a).call(this,u,this.tickVolume(u)+1),U(this,i,r).call(this,u,f),U(this,i,s).call(this,u,Math.max(f,this.high(u))),U(this,i,n).call(this,u,Math.min(f,this.low(u)))),this.lastBarAfter=this.bar(this.length-1),this.lastPrice=f}}}function v(t){let e;return function(i){if(!i)return;const{x:s,y:n}=i.data.global;e&&Math.abs(s-e.x)<3&&Math.abs(n-e.y)<3&&Date.now()-e.date<250&&t(i),e={x:s,y:n,date:Date.now()}}}t=new WeakMap,e=new WeakMap,i=new WeakSet,s=function(t,e){U(this,i,u).call(this,48*t+12,e)},n=function(t,e){U(this,i,u).call(this,48*t+20,e)},r=function(t,e){U(this,i,u).call(this,48*t+28,e)},a=function(t,e){U(this,i,m).call(this,48*t+36,e)},h=function(t,e){U(this,i,u).call(this,48*t+40,e)},l=function(){this.final=this.length>=9e3,this.final&&(this.buffer=this.buffer.slice(this.buffer.byteLength-432e3,this.buffer.byteLength)),w(this,t,new DataView(this.buffer))},o=function(e){return U(this,i,b).call(this,e,8)?p(this,t).getFloat64(e,!0):0},u=function(e,s){U(this,i,b).call(this,e,8)&&(p(this,t).setFloat64(e,s,!0),this.trigger("600",{symbol:this.symbol,period:this.period}))},c=function(e){return U(this,i,b).call(this,e,4)?p(this,t).getInt32(e,!0):0},f=function(e){return U(this,i,b).call(this,e,4)?p(this,t).getUint32(e,!0):0},m=function(e,s){U(this,i,b).call(this,e,4)&&(p(this,t).setUint32(e,s,!0),this.trigger("600",{symbol:this.symbol,period:this.period}))},b=function(t,e){return!(t<0||t>this.buffer.byteLength-e)},d=function(t,e=!1){const i=Math.floor(t/1e3),s=new Uint32Array(this.buffer),n=s.length/12,r=60*this.period;if(n){let t,a,h=0,l=n;for(;h<=l;){if(t=Math.floor(h+(l-h)/2),a=s[12*t],a>=i&&a<i+r)return t;a>i?l=t-1:h=t+1}if(e)return t||-1}return-1};const _=t=>t*Math.PI/180,I=(t,e,i,s)=>180*Math.atan2(s-e,i-t)/Math.PI,O=(t,e,i,s)=>Math.sqrt((t-i)*(t-i)+(e-s)*(e-s)),F=(t,e)=>{let i=Math.cos(_(e)),s=Math.sin(_(e));return 0===e||360===e?(i=1,s=0):90===e||-270===e?(i=0,s=1):180===e||-180===e?(i=-1,s=0):-90!==e&&270!==e||(i=0,s=-1),{x:i*t,y:s*t}},P=(t,e,i,s,n,r,a,h)=>{let l=null,o=null,u=!1,c=!1;const f=(h-r)*(i-t)-(a-n)*(s-e);if(0===f)return{x:l,y:o,line1:u,line2:c};let m=e-r,b=t-n;const d=(i-t)*m-(s-e)*b;return m=((a-n)*m-(h-r)*b)/f,b=d/f,l=t+m*(i-t),o=e+m*(s-e),m>0&&m<1&&(u=!0),b>0&&b<1&&(c=!0),{x:l,y:o,line1:u,line2:c}},j=(t,e,i,s)=>{const n=Math.max(t,i)-Math.min(t,i),r=Math.max(e,s)-Math.min(e,s);return{x:Math.min(t,i)+.5*n,y:Math.min(e,s)+.5*r}};function E(t,e,i,s){const n=I(t,e,i,s),r=function(t){const e=Math.floor(Math.abs(t)/45),i=t<0?-1:1;return Math.abs(Math.abs(t)%45)<22.5?i*e*45:i*e*45+45*i}(n),a=O(t,e,i,s),h=a*Math.sin(n),l=a*Math.cos(n),o=Math.sqrt(h**2+l**2),u=F(o,r);return{x:t+u.x,y:e+u.y}}function S(t,e,i,s,n,r){const{dash:a,gap:h=r.dash,color:l,alpha:o=1,width:u=1,alignment:c,native:f}=r,m=function(t,e,i,s){return Math.hypot(i-t,s-e)}(e,i,s,n),b=(s-e)/m,d=(n-i)/m;t.lineStyle(u,l,o,c,f),t.moveTo(e,i).lineTo(e+a*b,i+a*d);let g=a+h;for(;g<m;)t.moveTo(e+g*b,i+g*d),g+=a,t.lineTo(e+g*b,i+g*d),g+=h}function W(t){const e=t.sizes;return{indent:e.indent/2,fontFamily:e.font.family,axis:{yVisible:!0,yAlign:"right"}}}export{N as B,I as a,C as b,D as c,O as d,L as e,v as f,B as g,S as h,_ as i,P as j,j as k,E as l,V as o,F as p,W as u};
