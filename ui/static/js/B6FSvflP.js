var t,i,s,e,h,a,r,n,o,l,c,d,g,u,p,x,m,f,v,M,y,w,S,W,k,b,C,X,T,F,E,L,_,A,V,Y,H,D,U=t=>{throw TypeError(t)},P=(t,i,s)=>i.has(t)||U("Cannot "+s),I=(t,i,s)=>(P(t,i,"read from private field"),s?s.call(t):i.get(t)),N=(t,i,s)=>i.has(t)?U("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(t):i.set(t,s),R=(t,i,s,e)=>(P(t,i,"write to private field"),e?e.call(t,s):i.set(t,s),s),G=(t,i,s)=>(P(t,i,"access private method"),s);import{S as z,i as j,s as B,n as J,d as O,b as K,c as $,a5 as q,f as Q,ae as Z}from"./d_ed_6Ut.js";import{k as tt,S as it}from"./HcGwWu0z.js";import{C as st,B as et,G as ht}from"./CQ67ee1G.js";import{c as at}from"./BAEQURWy.js";function rt(t){let i,s;return{c(){i=q("svg"),s=q("path"),Q(s,"d","M19.0978 19.9009c.5395 0 .9214-.4151.9214-.9463 0-.249-.083-.4898-.2657-.6641l-3.9096-3.9179c.8217-1.0791 1.3115-2.4156 1.3115-3.8682 0-3.51124-2.8721-6.38331-6.3833-6.38331-3.50294 0-6.38331 2.86377-6.38331 6.38331 0 3.5112 2.87207 6.3833 6.38331 6.3833 1.3862 0 2.6645-.4482 3.7104-1.1953l3.9346 3.9346c.1826.1826.4234.2739.6807.2739zm-8.3257-4.3911c-2.73926 0-5.00538-2.2661-5.00538-5.0054 0-2.73926 2.26612-5.00538 5.00538-5.00538 2.7393 0 5.0054 2.26612 5.0054 5.00538 0 2.7393-2.2661 5.0054-5.0054 5.0054z"),Q(i,"width","24"),Q(i,"height","24"),Q(i,"xmlns","http://www.w3.org/2000/svg")},m(t,e){K(t,i,e),$(i,s)},p:J,i:J,o:J,d(t){t&&O(i)}}}class nt extends z{constructor(t){super(),j(this,t,null,rt,B,{})}}class ot{constructor(h=""){N(this,e),N(this,t),N(this,i),N(this,s,new Map),R(this,i,h),R(this,t,new EventTarget)}on(i,s){G(this,e,h).call(this,i,s),I(this,t).addEventListener(i,s)}once(i,s){I(this,t).addEventListener(i,s,{once:!0})}off(i,s){G(this,e,a).call(this,i,s),I(this,t).removeEventListener(i,s)}trigger(i,s){return I(this,t).dispatchEvent(new CustomEvent(i,{detail:s,cancelable:!0}))}destroy(){I(this,s).forEach(((i,s)=>{i.forEach((i=>{i&&I(this,t).removeEventListener(s,i)}))})),I(this,s).clear()}}t=new WeakMap,i=new WeakMap,s=new WeakMap,e=new WeakSet,h=function(t,i){const e=I(this,s).get(t)||new Set;e.add(i),I(this,s).set(t,e)},a=function(t,i){const e=I(this,s).get(t);e&&e.delete(i)};class lt extends ot{constructor(t){super(),N(this,r,(()=>{var t;null==(t=this.data)||t.forEach((t=>t.draw()))})),N(this,n,(t=>{var i;null==(i=this.data)||i.forEach((i=>i.tick(t.detail)))})),N(this,o,(()=>{const{chart:t}=this;t.sections.resize(),t.redraw()})),this.chart=t,this.destroy=this.destroy.bind(this),this.chart.on("119",I(this,r)),this.chart.on("120",I(this,n)),this.chart.on("121",this.destroy),this.on("201",I(this,o)),this.on("202",I(this,o)),this.on("203",I(this,o)),this.on("205",I(this,o)),this.on("206",I(this,o))}visible(t,i){this.setVisible(t,i),i?this.trigger("205",t):this.trigger("206",t)}edit(t){var i;const s=this.get(t);s&&this.trigger("207",{uid:t,digits:null==(i=s.section)?void 0:i.digits})}destroy(){super.destroy(),this.chart.off("119",I(this,r)),this.chart.off("120",I(this,n)),this.chart.off("121",this.destroy),this.off("201",I(this,o)),this.off("202",I(this,o)),this.off("203",I(this,o)),this.off("205",I(this,o)),this.off("206",I(this,o))}}function ct(t,i){const s=new Date(t);switch(s.setUTCMilliseconds(0),s.setUTCSeconds(0),i&&i>=60&&s.setUTCMinutes(0),i&&i>=1440&&s.setUTCHours(0),i&&i>=43200&&s.setUTCDate(1),i){case 5:s.setUTCMinutes(5*Math.floor(s.getUTCMinutes()/5));break;case 15:s.setUTCMinutes(15*Math.floor(s.getUTCMinutes()/15));break;case 30:s.setUTCMinutes(30*Math.floor(s.getUTCMinutes()/30));break;case 240:s.setUTCHours(4*Math.floor(s.getUTCHours()/4));break;case 10080:for(;0!==s.getUTCDay();)s.setUTCDate(s.getUTCDate()-1)}return s.getTime()}r=new WeakMap,n=new WeakMap,o=new WeakMap;const dt=120,gt=1/dt;class ut extends ot{constructor(t,i){super("state"),N(this,M),N(this,l),N(this,c),N(this,d),N(this,g),N(this,u),N(this,p),N(this,x),N(this,m),N(this,f),N(this,v),this._systemName="state",this.moving=!1,R(this,c,0),this.extrema=[0,0],this.xScale=.03336,this.yAxisIsLeft=!1,R(this,d,0),R(this,g,0),this.graphWidth=0,this.yAxisWidth=0,this.yVisible=!0,this.graphX=0,this.axisXHeight=24,this.graphY=0,R(this,u,0),this.xShift=0,R(this,p,0),this.dataMinValue=0,this.dataMaxValue=0,R(this,x,!1),R(this,m,0),R(this,f,(t=>{R(this,m,10**t.detail)})),R(this,v,(()=>{I(this,x)&&(this.trigger("500",I(this,x)),R(this,x,!1))})),R(this,l,t),this.xScale=i,I(this,l).on("105",I(this,f)),I(this,l).app.ticker.add(I(this,v))}reset(){this.calc()}getFrom(){return I(this,c)}setFrom(t){G(this,M,y).call(this,{xFrom:t})}getScale(){return this.xScale}getStep(){return I(this,d)}getPadding(){return I(this,p)}getCount(){return I(this,g)}setData(t){let i=!1;const s={};return void 0!==t.yAxisWidth&&this.yAxisWidth!==t.yAxisWidth&&(this.yAxisWidth=t.yAxisWidth,s.yAxisWidth=t.yAxisWidth,i=!0,this.calc()),void 0!==t.moving&&this.moving!==t.moving&&(this.moving=t.moving,s.moving=t.moving,i=!0),void 0!==t.xScale&&this.xScale!==t.xScale&&(this.xScale=t.xScale,s.xScale=t.xScale,i=!0),void 0!==t.axisXHeight&&this.axisXHeight!==t.axisXHeight&&(this.axisXHeight=t.axisXHeight,s.axisXHeight=t.axisXHeight,i=!0,this.resize()),i&&this.refresh(s),i}calc(){const{xScale:t}=this,i=this.yVisible?this.yAxisWidth:0,s=I(this,l).app.screen.width-i,e=this.yAxisIsLeft?i:0,h=Math.round(dt*t*100)/100,a=Math.ceil(s/h)+1,r=Math.ceil(.1*a),n=Math.floor(.8*a);return G(this,M,y).call(this,{graphWidth:s,graphX:e,graphY:0,xStep:h,xCount:a,xShiftRight:r,xShift:n}),G(this,M,w).call(this),this}resize(){const t=this.yVisible?this.yAxisWidth:0,{width:i,height:s}=I(this,l).app.screen;G(this,M,y).call(this,{graphWidth:i-t,graphHeight:s-this.axisXHeight});const e=I(this,c)+I(this,g);return this.calc(),G(this,M,y).call(this,{xFrom:e-I(this,g)}),G(this,M,w).call(this),this}scale(t,i){const s=Math.floor(1e5*Math.min(1,Math.max(gt,t)))/1e5;if("number"==typeof i){const t=this.xToIndex(i),e=this.indexToX(t);this.setData({xScale:s});const h=I(this,c)+(this.xToIndex(i)-I(this,c));this.calc(),G(this,M,y).call(this,{xFrom:h-(this.xToIndex(i)-I(this,c))}),this.move(this.indexToX(t)-e)}else{const t=I(this,p)/this.xScale;this.setData({xScale:s});const i=I(this,c)+I(this,g);this.calc(),G(this,M,y).call(this,{xFrom:i-I(this,g),xPadding:t*s}),G(this,M,w).call(this)}return this}scrollX(){return I(this,c)*I(this,d)+I(this,p)}resetPadding(){G(this,M,y).call(this,{xPadding:1})}scrollTo(t){const i=Math.round(t),s=Math.ceil(i/I(this,d));G(this,M,y).call(this,{xFrom:s,xPadding:-1*(i-s*I(this,d))}),G(this,M,w).call(this)}scrollMin(){return I(this,d)*-this.xShift+I(this,p)}scrollMax(){const t=(I(this,l).bars.length??0-I(this,g)+this.xShift-1)*I(this,d)+I(this,p);return"number"==typeof t&&!isNaN(t)&&Number.isFinite(t)?t:0}move(t){if(0===t)return this;const i=-this.xShift;if(t<0&&I(this,c)<=i)return G(this,M,y).call(this,{xFrom:i}),G(this,M,w).call(this),this;const s=I(this,l).bars.length-I(this,g)+this.xShift-1;if(t>0&&I(this,c)>=s)return G(this,M,y).call(this,{xFrom:s}),G(this,M,w).call(this),this;const e=Math.floor((t-I(this,p))/I(this,d))+1;return G(this,M,y).call(this,{xFrom:I(this,c)+e,xPadding:I(this,p)-(t-e*I(this,d))}),G(this,M,w).call(this),this}moveToEnd(){var t;return G(this,M,y).call(this,{xFrom:((null==(t=I(this,l).bars)?void 0:t.length)??0)-I(this,g)+I(this,u)}),G(this,M,w).call(this),this}moveToStart(){return G(this,M,y).call(this,{xFrom:-1,xPadding:1.45*I(this,d)}),G(this,M,w).call(this),this}startX(){const{graphWidth:t,xShift:i}=this;return t-Math.min(I(this,g)+1,I(this,l).bars.length+2*i)*I(this,d)+I(this,d)+I(this,p)}xToIndex(t){const i=t-(this.startX()-.5*I(this,d));return Math.floor(i/I(this,d))+I(this,c)}indexToX(t){return Math.round((t-I(this,c))*I(this,d)+this.startX())}isEnd(){return this.indexToX((I(this,l).bars.length||0)-1)<this.graphX+this.graphWidth}refresh(t){R(this,x,t)}destroy(){I(this,l).app.ticker.remove(I(this,v)),I(this,l).off("105",I(this,f))}}l=new WeakMap,c=new WeakMap,d=new WeakMap,g=new WeakMap,u=new WeakMap,p=new WeakMap,x=new WeakMap,m=new WeakMap,f=new WeakMap,v=new WeakMap,M=new WeakSet,y=function(t){let i=!1;const s={};void 0!==t.graphWidth&&this.graphWidth!==t.graphWidth&&(this.graphWidth=t.graphWidth,s.graphWidth=t.graphWidth,i=!0),void 0!==t.graphHeight&&this.graphHeight!==t.graphHeight&&(this.graphHeight=t.graphHeight,s.graphHeight=t.graphHeight,i=!0),void 0!==t.graphX&&this.graphX!==t.graphX&&(this.graphX=t.graphX,s.graphX=t.graphX,i=!0),void 0!==t.graphY&&this.graphY!==t.graphY&&(this.graphY=t.graphY,s.graphY=t.graphY,i=!0),void 0!==t.xStep&&I(this,d)!==t.xStep&&(R(this,d,t.xStep),s.xStep=t.xStep,i=!0),void 0!==t.xCount&&I(this,g)!==t.xCount&&(R(this,g,t.xCount),s.xCount=t.xCount,i=!0),void 0!==t.xShiftRight&&I(this,u)!==t.xShiftRight&&(R(this,u,t.xShiftRight),s.xShiftRight=t.xShiftRight,i=!0),void 0!==t.xShift&&this.xShift!==t.xShift&&(this.xShift=t.xShift,s.xShift=t.xShift,i=!0),void 0!==t.xPadding&&I(this,p)!==t.xPadding&&(R(this,p,t.xPadding),s.xPadding=t.xPadding,i=!0),void 0!==t.xFrom&&t.xFrom!==I(this,c)&&(R(this,c,t.xFrom),s.xFrom=t.xFrom,i=!0),void 0!==t.dataMinValue&&t.dataMinValue!==this.dataMinValue&&(this.dataMinValue=t.dataMinValue,s.dataMinValue=t.dataMinValue,i=!0),void 0!==t.dataMaxValue&&t.dataMaxValue!==this.dataMaxValue&&(this.dataMaxValue=t.dataMaxValue,s.dataMaxValue=t.dataMaxValue,i=!0),void 0!==t.extrema&&t.extrema!==this.extrema&&(this.extrema=t.extrema,s.extrema=t.extrema,i=!0),i&&this.refresh(s)},w=function(){G(this,M,S).call(this),G(this,M,W).call(this)},S=function(){let t=I(this,c);t=Math.max(t,-this.xShift),t=Math.min(t,(I(this,l).bars.length||0)+this.xShift-I(this,g)-1),G(this,M,y).call(this,{xFrom:t})},W=function(){const t=Math.max(0,I(this,c)),i=Math.max(0,I(this,c)+I(this,g)+1),s=I(this,l).bars.minmax(t,i)??[];if(s.length){if(G(this,M,y).call(this,{dataMinValue:s[0],dataMaxValue:s[1]}),0!==I(this,l).volumeType&&(I(this,l).bars.max(t,i,I(this,l).volumeType)??0)>Number.MIN_VALUE){const t=.25*(s[1]-s[0]);s[0]-=t}const e=Math.floor(s[0]*I(this,m)),h=Math.floor(s[1]*I(this,m));this.extrema[0]===e&&this.extrema[1]===h||G(this,M,y).call(this,{extrema:[e,h]})}};class pt extends st{constructor(t){super(),this.component=t}}class xt{constructor(t,i=1e5,s){N(this,C),N(this,k),N(this,b),this.yStep=0,this.yNull=0,this.extrema=[0,0],this.textPool={used:[],unUsed:new Map},R(this,b,{}),this.chart=t.chart,this.settings=s,this.section=t.section,this.container=new pt(this),this.container.zIndex=i,this.chart.app.stage.addChild(this.container),this.chart.app.stage.sortChildren(),R(this,k,new Map)}get yHeight(){var t;return((null==(t=this.section)?void 0:t.height)??0)-80}get yMin(){return this.chart.state.extrema[0]/this.getYDigits()}get yMax(){return this.chart.state.extrema[1]/this.getYDigits()}destroy(){this.clear(),this.chart.app.stage.removeChild(this.container)}draw(){return this.clear(),this._init(),this._calc(),this._before(),this._draw(),this}tick(t){this.chart.state.isEnd()&&this.draw()}clear(){this.container.removeChildren();const{used:t,unUsed:i}=this.textPool;t.forEach((t=>{const{text:s,name:e}=t,h=e||s;i.has(h)?t.destroy():i.set(h,t)})),this.textPool.used=[]}_init(){}getYDigits(){var t;return 10**((null==(t=this.section)?void 0:t.digits)??0)}_calc(t){}_before(){const{section:t}=this,i=this.yMin*this.getYDigits(),s=this.yMax*this.getYDigits(),e=(i+s)/2;this.yStep=this.yHeight/(s-i)*((null==t?void 0:t.getScale())??0),this.yNull=.5*((null==t?void 0:t.height)??0)+this.yStep*e+((null==t?void 0:t.getYPadding())??0)}createPriceLine(t="price",i=3355443,s=16777215,e=3355443,h=1){const{state:a}=this.chart,r=this._createGraphics(t);r.y=-1e3,r.beginFill(i,h),r.drawRect(a.graphX,0,a.graphWidth+1,1),r.endFill();const n=this.createText("",t);s&&(n.tint=s);const o=a.yAxisIsLeft?a.yAxisWidth-2:a.yAxisWidth-1,l=a.yAxisIsLeft?a.yAxisWidth-o+1:a.graphX+a.graphWidth+1;return n.y=-8,n.x=l+5,r.beginFill(e),r.drawRect(l,-9,o,18),r.endFill(),r.addChild(n),r}updatePriceLine(t="price",i=0,s=0){const{state:e}=this.chart,h=this._getGraphicsFromCache(t);if(h&&h.children.length){const a=h.getChildAt(0);if(a&&a instanceof et)return a.text=i.toFixed(s),e.yAxisIsLeft&&this.changed(`__price_${t}`,Math.floor(i))&&(a.x=e.yAxisWidth/2),a.y}return 0}valueToY(t){return Math.round(this.yNull-t*this.getYDigits()*this.yStep)}yToValue(t,i=!0){const{yNull:s,yStep:e}=this;let h=t;return i&&(h<0?h=0:h>this.section.height&&(h=this.section.height)),(s-h)/e/this.getYDigits()}get view(){return this.container}createText(t,i="",s=!0){const{used:e,unUsed:h}=this.textPool,a=i||t;let r;if(a&&(r=h.get(a),h.delete(a)),!r){const s=h.entries().next().value;s&&(r=s[1],h.delete(s[0])),r&&(r.text=t,r.name=i)}return r||(r=new et(t,{fontName:"Trebuchet MS",fontSize:16})),e.push(r),r&&(!s&&i||(r.alpha=1,r.tint=0,r.eventMode="auto",r.cursor="pointer"),r.name=i),r}_createGraphics(t="main"){let i=this._getGraphicsFromCache(t);return i?(i.removeChildren(),i.clear(),i.x=0,i.y=0):i=G(this,C,X).call(this,t),i}_getGraphicsFromCache(t){return I(this,b)[t]?I(this,b)[t]:null}changed(t,...i){const s=String([t,...i].join("")),e=I(this,k).get(t)!==s;return I(this,k).set(t,s),e}}function mt(t){const i=new Uint8Array(Math.floor(t/2));return crypto.getRandomValues(i),Array.from(i,(t=>t.toString(16))).join("")}function ft(t,i={}){var s,e;t.uid=i.uid||mt(16),t.type=i.type||t.type||"",t.parent=i.parent||t.parent||"",t.visible=i.visible??t.visible??!0,t.title=i.title||t.title||"",t.digits=t.digits??0,t.mask={period:(null==(s=i.mask)?void 0:s.period)??511,navigator:(null==(e=i.mask)?void 0:e.navigator)??!0},i.params&&(t.params={...i.params}),i.style&&(t.style=tt(t.style,i.style))}function vt(t){const i={uid:t.uid,type:t.type,index:t.index,params:{distance:t.params.distance},style:{...t.style}};t.visible||(i.visible=t.visible);const s=t.mask;return 511===s.period&&s.navigator||(i.mask={},511!==s.period&&(i.mask.period=s.period),s.navigator||(i.mask.navigator=s.navigator)),i}k=new WeakMap,b=new WeakMap,C=new WeakSet,X=function(t){const i=new ht;return i.name=t,G(this,C,T).call(this,t,i),i},T=function(t,i){I(this,b)[t]=i};const Mt=class t extends it{constructor(i){super(),this.category=t.category,this.title=t.title,this.style={},this.digits=0,this.flags=19,this.uid=mt(16),this.parent="",this.visible=!0,this.mask={period:511,navigator:!0},this.params={distance:10},this.type=i.type,i&&ft(this,i)}toJSON(){return vt(this)}};Mt.category=1,Mt.title="",Mt.flags=19;let yt=Mt;class wt extends xt{constructor(t,i=5e3,s){super(t,i,s)}draw(){return this.clear(),this.visible()?(this.isDrawingAllowed()&&(this._init(),this._calc(),this._before(),this._draw()),this):this}calc(){return this._init(),this._calc(),this}visible(){return this.settings.visible}tick(){this.draw()}isDrawingAllowed(){const{settings:t}=this;if(t){const{period:i}=this.chart.bars,s=t.mask.period;return!!(1===i&&1&s||5===i&&2&s||15===i&&4&s||30===i&&8&s||60===i&&16&s||240===i&&32&s||1440===i&&64&s||10080===i&&128&s||43200===i&&256&s)}return!0}_draw(t){if(!this.section)return;const i=this._createGraphics("mask");i.isMask=!0,i.x=Math.round(this.section.x),i.y=Math.round(this.section.y),i.beginFill(),i.drawRect(0,0,this.section.width+1,this.section.height),i.endFill(),this.container.addChild(i);const s=this._createGraphics();s.x=i.x,s.y=i.y,s.mask=i,s.eventMode="none",this._drawGraph(s,t),this.container.addChild(s)}}navigator.userAgent.toLocaleLowerCase().indexOf("firefox");class St{constructor(t){N(this,F),N(this,E,0),N(this,L,0),N(this,_,0),N(this,A,(t=>{t.preventDefault()})),N(this,V,Z(10,(t=>{t.preventDefault(),t.stopPropagation();const i=I(this,F).state.getStep();let s=t.wheelDeltaY;!s&&t.deltaY&&(s=-1*t.deltaY);let e=t.wheelDeltaX;if(!e&&t.deltaX&&(e=-1*t.deltaX),e){const t=I(this,F).state.getFrom();let s=-1*e/(i-i%10+11-i);s=Math.abs(s)<1?Math.round(s):Math.floor(s),I(this,F).move(s),I(this,F).onScroll(t)}else if(s){const e=I(this,F).state.getFrom(),h=i/dt*2.5;let a=Math.log10(Math.abs(s))*h*(s/Math.abs(s));a>0&&a<.012&&(a=.012),a<0&&a>-.012&&(a=-.012);const r=Math.max(1,i+a)/dt;I(this,F).setXScale(r,t.metaKey&&t.layerX?t.layerX:void 0),I(this,F).onScroll(e)}}))),N(this,Y,(t=>{var i;if(2===t.touches.length){const s=t.touches[0],e=t.touches[1];if(R(this,E,Math.hypot(s.pageX-e.pageX,s.pageY-e.pageY)),I(this,F).state.moving=!0,R(this,L,I(this,F).state.xScale),t.target instanceof HTMLElement){const s=null==(i=t.target)?void 0:i.getBoundingClientRect();s&&R(this,_,s.left)}}})),N(this,H,Z(10,(t=>{if(I(this,F).state.moving&&2===t.touches.length){const i=I(this,F).state.getFrom(),s=t.touches[0],e=t.touches[1],h=Math.hypot(s.pageX-e.pageX,s.pageY-e.pageY),a=Math.floor((s.pageX-I(this,_)+(e.pageX-I(this,_)))/2);I(this,F).setXScale(I(this,L)*(h/I(this,E)),a),I(this,F).onScroll(i)}}))),N(this,D,(()=>{I(this,F).state.moving=!1,I(this,F).redraw()})),R(this,F,t);const i=t.element;i&&(i.addEventListener("wheel",I(this,V)),i.addEventListener("wheel",I(this,A)),at()&&(i.addEventListener("touchstart",I(this,Y)),i.addEventListener("touchmove",I(this,H)),i.addEventListener("touchend",I(this,D)),i.addEventListener("touchcancel",I(this,D))))}destroy(){const t=I(this,F).element;t&&(t.removeEventListener("wheel",I(this,V)),t.removeEventListener("wheel",I(this,A)),t.removeEventListener("touchstart",I(this,Y)),t.removeEventListener("touchmove",I(this,H)),t.removeEventListener("touchend",I(this,D)),t.removeEventListener("touchcancel",I(this,D)))}}F=new WeakMap,E=new WeakMap,L=new WeakMap,_=new WeakMap,A=new WeakMap,V=new WeakMap,Y=new WeakMap,H=new WeakMap,D=new WeakMap;export{wt as B,xt as C,yt as E,dt as M,nt as S,ct as a,lt as b,ot as c,ut as d,St as e,pt as f,ft as g,gt as h,mt as r,vt as t};
