var t,i,e,s,n,o,r,a,h,c,d,l,u,y,w=t=>{throw TypeError(t)},g=(t,i,e)=>i.has(t)||w("Cannot "+e),x=(t,i,e)=>(g(t,i,"read from private field"),e?e.call(t):i.get(t)),p=(t,i,e)=>i.has(t)?w("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(t):i.set(t,e),v=(t,i,e,s)=>(g(t,i,"write to private field"),s?s.call(t,e):i.set(t,e),e),m=(t,i,e)=>(g(t,i,"access private method"),e);import{l as b,k as f,m as M}from"./HcGwWu0z.js";import{c as j}from"./BAEQURWy.js";import"./CQ67ee1G.js";import{aa as k}from"./d_ed_6Ut.js";import{C as P,r as _}from"./B6FSvflP.js";import{p as L,a as C,d as O}from"./Bp5cWvCe.js";function T(t){switch(t){case 1:return window.tr(window.lang.chart.objects.andrewsPitchforkChannel);case 2:return window.tr(window.lang.chart.objects.equidistantChannel);case 3:return window.tr(window.lang.chart.objects.regressionChannel);case 4:return window.tr(window.lang.chart.objects.stdDevChannel);case 5:return window.tr(window.lang.chart.objects.fibonacciRetracement);case 6:return window.tr(window.lang.chart.objects.gannFan);case 7:return window.tr(window.lang.chart.objects.gannGrid);case 8:return window.tr(window.lang.chart.objects.gannLine);case 9:return window.tr(window.lang.chart.objects.arrowLine);case 10:return window.tr(window.lang.chart.objects.crossLine);case 11:return window.tr(window.lang.chart.objects.extendedLine);case 12:return window.tr(window.lang.chart.objects.horizontalRay);case 13:return window.tr(window.lang.chart.objects.horizontalLine);case 14:return window.tr(window.lang.chart.objects.infoLine);case 15:return window.tr(window.lang.chart.objects.rayLine);case 16:return"Trade line";case 17:return window.tr(window.lang.chart.objects.trendAngle);case 18:return window.tr(window.lang.chart.objects.trendline);case 19:return window.tr(window.lang.chart.objects.verticalLine);case 20:return window.tr(window.lang.chart.objects.disjointAngle);case 21:return window.tr(window.lang.chart.objects.flatTopBottom);case 22:return window.tr(window.lang.chart.objects.rectangle);case 24:return window.tr(window.lang.chart.objects.circle);case 25:return window.tr(window.lang.chart.objects.triangle);case 26:return window.tr(window.lang.chart.objects.ellipse);case 27:return window.tr(window.lang.chart.objects.text);case 28:return window.tr(window.lang.chart.objects.rulerLine);default:return"Object"}}function S(t){const{hover:i,focused:e,active:s}=t,n=t.chart.colors.chart.object.point;return s?n.active:e?n.focus:i?n.hover:null}function W(t,i){const e=[];let s=Math.abs(i-t)/1e3/60;const n=Math.floor(s/24/60);n&&e.push(`${n} days`),s-=1440*n;const o=Math.floor(s/60)%24;o&&e.push(`${o} hours`),s-=60*o;const r=Math.floor(s)%60;return r&&e.push(`${r} minutes`),e.join(" ")}function F(t,i){const e=t.x2-t.x1,s=t.y2-t.y1,n=i.x2-i.x1,o=i.y2-i.y1,r=e*o-n*s;if(0===r)return!1;const a=((i.x1-t.x1)*o-(i.y1-t.y1)*n)/r,h=((i.x1-t.x1)*s-(i.y1-t.y1)*e)/r;return a>=0&&a<=1&&h>=0&&h<=1}function E(t,i){const{x1:e,x2:s,y1:n,y2:o}=t,r={x1:s,x2:s,y1:n,y2:o},a={x1:e,x2:s,y1:n,y2:n},h={x1:e,x2:s,y1:o,y2:o},c=F({x1:e,x2:e,y1:n,y2:o},i),d=F(r,i),l=F(a,i),u=F(h,i);return c||d||l||u}function K(t,i){const[e,s,n,o]=[Math.min(t.x1,t.x2),Math.max(t.x1,t.x2),Math.min(t.y1,t.y2),Math.max(t.y1,t.y2)],[r,a,h,c]=[Math.min(i.x1,i.x2),Math.max(i.x1,i.x2),Math.min(i.y1,i.y2),Math.max(i.y1,i.y2)];return!(e<r&&s<r||e>a&&s>a||n<h&&o<h||n>c&&o>c)}function D(t,i){const e=[{x1:t.x1,x2:t.x1,y1:t.y1,y2:0},{x1:t.x2,x2:t.x2,y1:t.y1,y2:0},{x1:t.x1,x2:t.x1,y1:t.y2,y2:0},{x1:t.x2,x2:t.x2,y1:t.y2,y2:0}],{x1:s,x2:n,x3:o,x4:r,y1:a,y2:h,y3:c,y4:d}=i;for(let l=0;l<e.length;l++){const t=e[l],i=F(t,{x1:s,x2:n,y1:a,y2:h}),u=F(t,{x1:n,x2:o,y1:h,y2:c}),y=!(!r||!d)&&F(t,{x1:o,x2:r,y1:c,y2:d}),w=F(t,r&&d?{x1:r,x2:s,y1:d,y2:a}:{x1:o,x2:s,y1:c,y2:a}),g=Number(i)+Number(u)+Number(y)+Number(w);if(g%2!=1||0===g)return!1}return!0}function N(t,i,e){const[s,n,o,r]=[Math.min(t.x1,t.x2),Math.max(t.x1,t.x2),Math.min(t.y1,t.y2),Math.max(t.y1,t.y2)];return void 0!==i&&void 0!==e?s<i&&i<n&&o<e&&e<r:void 0!==i&&void 0===e?s<i&&i<n:void 0===i&&void 0!==e&&o<e&&e<r}function A(t,i){const[e,s,n,o]=[Math.min(t.x1,t.x2),Math.max(t.x1,t.x2),Math.min(t.y1,t.y2),Math.max(t.y1,t.y2)],{x1:r,x2:a,x3:h,x4:c,y1:d,y2:l,y3:u,y4:y}=i,w=c?Math.min(r,a,h,c):Math.min(r,a,h),g=c?Math.max(r,a,h,c):Math.max(r,a,h),x=y?Math.min(d,l,u,y):Math.min(d,l,u),p=y?Math.max(d,l,u,y):Math.max(d,l,u);return e<=w&&s>=g&&n<=x&&o>=p}function U(t,i,e,s,n){const o=j()?6:2,r=C(i,e,s,n),a=L(o,r-90),h=L(o,r+90);t.lineStyle(),t.beginFill(void 0,.01),t.moveTo(i+a.x,e+a.y),t.lineTo(s+a.x,n+a.y),t.lineTo(s+h.x,n+h.y),t.lineTo(i+h.x,e+h.y),t.endFill()}class I extends P{constructor(i,e=7e3,s){super(i,e,s),p(this,t),this._moveStartPoint={x:0,y:0},this.section=i.section,this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverObject=this.onPointerOverObject.bind(this),this.onPointerMoveObject=this.onPointerMoveObject.bind(this),this.onPointerOutObject=this.onPointerOutObject.bind(this)}get yHeight(){const{section:t}=this,{indicator:i}=t;return i?(i.calc(),i.yHeight):super.yHeight}get yMin(){const{section:t}=this,{indicator:i}=t;return i?(i.calc(),i.yMin):super.yMin}get yMax(){const{section:t}=this,{indicator:i}=t;return i?(i.calc(),i.yMax):super.yMax}start(t){return this.onPointerDown(t),this}draw(){return this.clear(),this.chart.hidden?this:this.visible()?(this.isDrawingAllowed()&&(this._init(),this._calc(),this._before(),this._draw()),this):this}focus(t){return this.focused||(this.focused=!0,this.draw(),this.chart.objects.trigger("3006",{ctrlKey:t.ctrlKey,metaKey:t.metaKey,uid:this.settings.uid})),this}blur(){return this.focused&&(this.focused=!1,this.draw(),this.chart.objects.trigger("3004",{uid:this.settings.uid})),this}move(t){const{settings:i}=this;return i.setCoordinates(t),this.draw(),this}visible(){return this.section.indicator?this.settings.visible&&this.section.indicator.settings.visible:this.settings.visible}tick(t){return this}isDrawingAllowed(){const{settings:t}=this;if(t){const{period:i}=this.chart.bars,e=t.mask.period;return!!(1===i&&1&e||5===i&&2&e||15===i&&4&e||30===i&&8&e||60===i&&16&e||240===i&&32&e||1440===i&&64&e||10080===i&&128&e||43200===i&&256&e)}return!0}_draw(){this._mask=this._createMask();const t=this._createGraphics("object");t.x=this._mask.x,t.y=this._mask.y,t.mask=this._mask,t.eventMode=this.chart.locked||this.settings.lock?"auto":"static";const i=this._createGraphics("bg");t.x=this._mask.x,t.y=this._mask.y,i.mask=this._mask,i.eventMode="auto",this.container.addChild(i),t.removeEventListener("pointerdown",this.onPointerDown),t.removeEventListener("pointerover",this.onPointerOverObject),t.removeEventListener("pointermove",this.onPointerMoveObject),t.removeEventListener("pointerout",this.onPointerOutObject),t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointerover",this.onPointerOverObject),t.addEventListener("pointermove",this.onPointerMoveObject),t.addEventListener("pointerout",this.onPointerOutObject),this._drawObject(t,i),this.container.addChild(t)}_createMask(){let t=this.section.y,i=this.section.height;1&this.settings.flags&&(t=this.chart.state.graphY,i=this.chart.state.graphHeight);const e=this._createGraphics("mask");return e.isMask=!0,e.x=Math.round(this.section.x),e.y=Math.round(t),e.beginFill(),e.drawRect(0,0,this.section.width+1,i),e.endFill(),this.container.addChild(e),e}_drawPoint(t,i,e,s,n=7,o=!1){let r=Math.round(j()?1.8*n:1.5*n);r=o?1.2*r:r,t.beginFill(void 0,.01),t.lineStyle(),t.drawCircle(e,s,r),t.endFill(),o||(t.beginFill(i.backgroundColor),t.lineStyle(2,i.borderColor),t.drawCircle(e,s,n),t.endFill())}_drawLineSegment(t,i,e,s,n,o,r,a,h=!1){h&&U(t,i,e,s,n),t.lineStyle(o,r,a),t.moveTo(i,e),t.lineTo(s,n)}_mouse(t){const{section:i}=this,{x:e,y:s}=t.data.global,n={x:e-i.x,y:s-i.y};if(this.chart.magnet&&this.activePoint){const t=this.chart.bars,i=this.chart.state.xToIndex(n.x),e=this.yToValue(n.y),s=t.open(i),o=t.high(i),r=t.low(i),a=t.close(i);let h,c;h=s<a?[o,a,s,r]:[o,s,a,r],c=e>(h[0]+h[1])/2?h[0]:e>(h[1]+h[2])/2?h[1]:e>(h[2]+h[3])/2?h[2]:h[3],n.y=this.valueToY(c)}return n}onPointerDown(e){const{x:s,y:n}=this._mouse(e);(!j()||j()&&this.focused)&&e.stopPropagation(),j()||(this.focused||(this.focused=!0,this.chart.objects.trigger("3006",{ctrlKey:e.ctrlKey,metaKey:e.metaKey,uid:this.settings.uid})),this.draw());const{stage:o}=this.chart.app;o&&(o.removeEventListener("pointermove",this.onPointerMove),o.removeEventListener("pointerup",this.onPointerUp)),this._moveStartPoint={x:s,y:n},this._moveStartCoordinates=b(this.settings.coordinates),m(this,t,i).call(this,e)?this.settings.customizable&&this.chart.objects.trigger("3001",{uid:this.settings.uid}):(this.chart.objects.trigger("3002",{uid:this.settings.uid}),o&&(o.addEventListener("pointermove",this.onPointerMove),o.addEventListener("pointerup",this.onPointerUp)))}onPointerMove(t){if(this.activePoint||!this.focused)return void this.chart.objects.trigger("3005",{uid:this.settings.uid});const{settings:i,chart:e}=this,{state:s}=e,n=this.chart.bars,{x:o,y:r}=this._mouse(t),a=o-this._moveStartPoint.x,h=r-this._moveStartPoint.y;let c,d,l,u=!1;this._moveStartCoordinates&&(Object.entries(this._moveStartCoordinates).forEach((([t,e])=>{if(("date1"===t||"date2"===t||"date3"===t||"date4"===t)&&"number"==typeof e){const o=e,r=n.index(o),h=s.indexToX(r)+a,d=s.xToIndex(h),y=n.time(d);c=y-o,l=d-r,i.setCoordinates({[t]:y}),u=!0}if(("price1"===t||"price2"===t||"price3"===t||"price4"===t)&&"number"==typeof e){const s=e,n=this.valueToY(e)+h,o=this.yToValue(n);d=o-s,i.setCoordinates({[t]:o}),u=!0}})),u&&(this.draw(),this.chart.objects.trigger("3005",{uid:this.settings.uid,bar:l,date:c,price:d})))}onPointerUp(t){const{x:i,y:e}=this._mouse(t),s=Math.abs(i-this._moveStartPoint.x),n=Math.abs(e-this._moveStartPoint.y);j()&&s<3&&n<3&&(this.focused||(this.focused=!0,this.chart.objects.trigger("3006",{ctrlKey:t.ctrlKey,metaKey:t.metaKey,uid:this.settings.uid})),this.draw()),this.chart.objects.trigger("3003",{uid:this.settings.uid});const{stage:o}=this.chart.app;o&&(o.removeEventListener("pointermove",this.onPointerMove),o.removeEventListener("pointerup",this.onPointerUp)),this.settings.history&&this.settings.firstCreation&&(this.settings.firstCreation=!1,this.chart.objects.trigger("3007",{uid:this.settings.uid}))}onPointerOverObject(){this.hover=!0;const t=this.container.getChildByName("object");t&&(this.chart.locked||this.settings.lock||(t.cursor="pointer")),this.draw()}onPointerMoveObject(t){}onPointerOutObject(){this.hover=!1;const t=this.container.getChildByName("object");t&&(t.cursor="default"),this.draw()}}t=new WeakSet,i=function(t){const{x:i,y:e}=this._mouse(t);return this._clickTime&&i===this._clickX&&e===this._clickY&&Date.now()-this._clickTime<250?(t.doubleClick=!0,!0):(this._clickTime=Date.now(),this._clickX=i,this._clickY=e,t.doubleClick=!1,!1)};class J{constructor(t,i,u,y,w,g,m){var M,j;p(this,l),p(this,e),p(this,s),p(this,n),p(this,o),p(this,r),p(this,a),p(this,h),p(this,c),p(this,d);const P=t??{uid:_(16),type:y};v(this,h,i),v(this,c,u),v(this,d,g),this.type=P.type??y,this.uid=P.uid||_(16),this.parent=P.parent??"",this.flags=P.flags??g,this.category=w,this.firstCreation=P.firstCreation??!0,this.history=P.history??!0,this.customizable=m,v(this,s,P.visible??!0),this.visible=x(this,s),v(this,e,P.lock??!1),this.lock=x(this,e),v(this,r,P.name??T(this.type)),this.name=x(this,r),v(this,n,JSON.stringify({...i,...P.coordinates})),this.coordinates=JSON.parse(x(this,n)),v(this,o,JSON.stringify(f(b(u),b(P.style??{})))),this.style=JSON.parse(x(this,o)),v(this,a,JSON.stringify({period:(null==(M=P.mask)?void 0:M.period)??511,navigator:(null==(j=P.mask)?void 0:j.navigator)??!0})),this.mask=JSON.parse(x(this,a));const{subscribe:L,update:C,set:O}=k(this);this.subscribe=L,this.update=C,this.set=O}refresh(){this.set(this)}setCoordinates(t){this.coordinates={...this.coordinates,...t},m(this,l,u).call(this)}setVisible(t){this.visible=t,this.refresh()}toJSON(){const t={type:this.type,uid:this.uid};this.parent&&(t.parent=this.parent),this.visible||(t.visible=this.visible),this.lock&&(t.lock=this.lock),this.flags!==x(this,d)&&(t.flags=this.flags);const i=M(x(this,h),this.coordinates)||{};i&&Object.keys(i).length&&(t.coordinates=i);const e=M(x(this,c),this.style);e&&Object.keys(e).length&&(t.style=e);const{mask:s}=this;return 511===s.period&&s.navigator||(t.mask={},511!==s.period&&(t.mask.period=s.period),s.navigator||(t.mask.navigator=s.navigator)),this.name&&this.name!==T(this.type)&&(t.name=this.name),void 0!==this.firstCreation&&(t.firstCreation=this.firstCreation),void 0!==this.history&&(t.history=this.history),t}}e=new WeakMap,s=new WeakMap,n=new WeakMap,o=new WeakMap,r=new WeakMap,a=new WeakMap,h=new WeakMap,c=new WeakMap,d=new WeakMap,l=new WeakSet,u=function(){this.update((()=>this))};const z=class extends J{constructor(t){super(t,{date1:0,price1:0},{line:{color:434403,thickness:2,price:!0,time:!0}},10,1,1,!0)}};z.category=1;let R=z;class Y extends I{constructor(t,i=7e3,e){super(t,i,e),p(this,y,0),this.onLinePointerDown=this.onLinePointerDown.bind(this),this.onLinePointerMove=this.onLinePointerMove.bind(this),this.onLinePointerUp=this.onLinePointerUp.bind(this)}start(t){this.draw();const{settings:i,chart:e}=this,{state:s}=e,n=this.chart.bars,{x:o,y:r}=this._mouse(t),a=this.yToValue(r);let h;return"number"==typeof i.coordinates.date1&&(h=n.time(s.xToIndex(o))),i.setCoordinates({price1:a,date1:h}),super.start(t),this}onLinePointerDown(t){var i,e;const{chart:s,settings:n}=this,{state:o}=s,r=this.chart.bars,{coordinates:a}=n,{price1:h}=a;if(!h)return;const c=this.valueToY(h),{x:d,y:l}=this._mouse(t);let u=o.graphWidth/2;if(a.date1){const t=r.index(a.date1);u=o.indexToX(t)}O(d,l,u,c)<9&&(this.activePoint=1),null==(i=this.chart.app.stage)||i.off("pointermove",this.onLinePointerMove).off("pointerup",this.onLinePointerUp),this.activePoint&&(this._moveStartPoint={x:d,y:l},this.draw(),this.chart.objects.trigger("3006",{ctrlKey:t.ctrlKey,metaKey:t.metaKey,uid:this.settings.uid}),t.doubleClick||null==(e=this.chart.app.stage)||e.on("pointermove",this.onLinePointerMove).on("pointerup",this.onLinePointerUp))}onLinePointerMove(t){const{activePoint:i,chart:e}=this,{state:s}=e;if(i){this.active=!0;const{settings:e}=this,n=this.chart.bars,o=this._moveStartCoordinates;if(!o)return;const r=this._moveStartPoint,{x:a,y:h}=this._mouse(t),c=a-r.x,d=h-r.y;let l,u;if(1===i&&(l=o.date1,u=o.price1),!u||e.coordinates.date1&&!l)return;if(e.coordinates.date1&&l){let t=s.indexToX(n.index(l));t+=c,l=n.time(s.xToIndex(t))}let y=this.valueToY(u);y+=d,1===i&&e.setCoordinates({date1:l,price1:this.yToValue(y)}),this.draw()}}onLinePointerUp(){var t;this.active=!1,this.activePoint=void 0,this.draw(),null==(t=this.chart.app.stage)||t.off("pointermove",this.onLinePointerMove).off("pointerup",this.onLinePointerUp)}_drawMask(){const{section:t,chart:i,settings:e}=this,{state:s}=i;if(e.style.line.price){const e=this._mask;null==e||e.clear(),null==e||e.beginFill(),null==e||e.drawRect(s.yAxisIsLeft?-s.yAxisWidth:0,0,i.app.screen.width,t.height),null==e||e.endFill()}}_drawLine(t,i=0,e=0,s=0){const{chart:n,settings:o,section:r}=this,{state:a}=n,h=o.style.line,c=j()?16:8;if(t.beginFill(void 0,.01),t.drawRect(e,s-c/2,Math.round(a.graphWidth-e)+1,c),t.endFill(),t.beginFill(h.color),t.drawRect(e,s-Math.floor(h.thickness/2),Math.round(a.graphWidth-e)+1,h.thickness),t.endFill(),h.price){const e=this.createText(i.toFixed(r.digits));e.tint=h.priceColor?h.priceColor:this.chart.invert(h.color,!0);const n=a.yAxisIsLeft?a.yAxisWidth-2:a.yAxisWidth-1,o=a.yAxisIsLeft?1-n:a.graphX+a.graphWidth+1,c=18,d=h.priceFill||h.color;if(t.beginFill(d),t.lineStyle(1,h.color,1,0),t.drawRect(o,s-c/2,n,c),t.endFill(),e.y=s-c/2+1,e.x=Math.round(o+5),a.yAxisIsLeft){let t=x(this,y);t&&!this.changed("priceWidth",i.toFixed().length,r.digits)||(v(this,y,e.textWidth),t=x(this,y)),e.x=-t-8}t.addChild(e)}}_drawText(t,i=0,e=0){const{settings:s,chart:n}=this,{state:o}=n,{text:r}=s.style;if(r.content&&r.visible){const s=this.createText(r.content,this.settings.uid,!1);this.changed(this.settings.uid,r.color,r.content)&&(s.tint=r.color,s.text=r.content);const n=o.graphWidth-i,a=s.width,h=r.size;switch(r.align){case 1:s.x=i+n-a-5;break;case 2:s.x=i+n/2-a/2;break;default:s.x=i+5}switch(r.valign){case 0:s.y=e-h-3;break;case 2:s.y=e-h;break;default:s.y=e+3}o.yAxisIsLeft?s.x<5&&(s.x=5):s.x+a>o.graphWidth-5&&(s.x=o.graphWidth-a-5),t.addChild(s)}}_drawSelected(t,i=0,e=0){const{hover:s,focused:n,active:o}=this;if(s||n||o){const s=S(this);s&&this._drawPoint(t,s,i,e)}}}y=new WeakMap;const V=()=>({line:{color:8432304,thickness:2,price:!0},text:{visible:!1,color:6262678,size:12,content:"",align:2,valign:0}}),X=class extends J{constructor(t){super(t,{price1:0},{line:{color:8432304,thickness:2,price:!0},text:{visible:!1,color:6262678,size:12,content:"",align:2,valign:0}},13,1,0,!0)}};X.category=1;let H=X;export{I as B,R as C,Y as H,J as O,E as a,A as b,K as c,W as d,N as e,V as f,S as g,H as h,U as i,T as j,F as l,D as r};
